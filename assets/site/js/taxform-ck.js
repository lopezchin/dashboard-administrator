// Global Variables and Function that doesnt need to be instanciated manually
var $body=$("body");$body.delegate("button[type=submit].btn_action","click",function(e){var t=$(this),n=t.closest("form"),r=t.attr("name"),i=t.attr("value");if(typeof r!="undefined"){n.find(".temp_input").remove();n.find("input[name="+r+"]").length||n.prepend('<input class="temp_input" type="hidden" name="'+r+'" value="'+i+'">')}});var qvXhr;$body.delegate("input.quick-validate","keyup",function(e){var t=$(this),n=t.closest("form"),r=t.closest(".js-validator"),i=r.find(".validator-message"),s=t.data("targeturl"),o;qvXhr&&qvXhr.abort();qvXhr=jQuery.ajax({type:"GET",url:s,data:{input_value:$(this).val()},dataType:"json",beforeSend:function(){r.removeClass("has-error");i.html("");o=$('<i class="fa fa-spinner fa-spin" style="display: block;"></i>').appendTo(i)},success:function(e){if(e.status=="success")$('<i class="fa fa-check" style="display: block;"></i>').appendTo(i);else{r.addClass("has-error");var n='<i class="fa fa-exclamation-triangle form-control-feedback"></i>  <span class="form-control-feedback-msg">'+e.messageError+"</span>";$(n).appendTo(i.html(""))}$formGroup=t.closest(".form-group");$feedbackMsg=$formGroup.find(".form-control-feedback-msg");$(".form-control-feedback-msg").hide("fast");$formGroup.hasClass("form-group-left")?$feedbackMsg.css("left",-335).css("left",-($feedbackMsg.width()+35)).fadeIn("fast"):$feedbackMsg.css("right",-335).css("right",-($feedbackMsg.width()+35)).fadeIn("fast")},complete:function(){o.remove()}})});var url=document.location.toString();url.match("#")&&$(".nav-tabs a[href=#"+url.split("#")[1]+"]").tab("show");$(".nav-tabs a").on("click",function(e){window.location.hash=e.target.hash});$.loadTab={start:function(e){var t=$($(this).attr("href"));e.addClass("loading");t.addClass("loading")},stop:function(e){var t=$($(this).attr("href"));e.removeClass("loading");t.removeClass("loading")}};$.taxform={init:function(){var e=this;e.formItem.init();e.scrollRoll();e.disableInProgressFields()},scrollRoll:function(){var e=$(".section-l6");e.length&&$(".t-sidebar-inner").scrollToFixed({marginTop:$(".banner").outerHeight()-380,limit:e.offset().top-$(".t-sidebar-inner").outerHeight(),zIndex:1})},triggerQuickAction:function(e){e&&e.trigger("click")},disableInProgressFields:function(){var e=this,t=$(".body-tax-not-in-progress").find(".tax-return-form");t.length&&t.find("input[type=text],textarea,select,input[type=radio],input[type=checkbox]").prop("disabled","disabled")}};$.taxform.h={windowFocus:function(e){if(typeof e!="undefined"){var t=e.offset(),n=t.top-$(window).height()*.16;$("html").scrollTop(n-150)}}};$.taxform.formItem={init:function(){var e=this;e.$section="";e.onLoad();e.addFieldItem();e.removeFieldItem();e._resetRemove();e.removeButton();e.editQuickAction();e.deleteQuickAction()},onLoad:function(){$(".form-2cloned").css("display","none").find("input,checkbox,textarea,select").filter(":not(:disabled)").addClass("temporary-disabled").prop("disabled",!0)},removeFieldItem:function(){var e=this;$body.delegate("click","#remove_base_level",function(t){t.preventDefault();if($("#base_levels .item-level").length>1){$(this).closest(".item-level").remove();e._resetIndex()}})},_resetRemove:function(){$(".remove_form_item").remove();$(".form-fieldset").each(function(){$('<a href="#" class="remove_form_item" class="btn btn-warning"><i class="fa fa-times"></i>Remove</a>').appendTo($(this).find(".form-item"));$(this).find(".form-item").length<=1&&$(this).hasClass("fieldset-exclude-first")&&$(this).find(".form-item").first().find(".remove_form_item").remove()})},removeButton:function(){var e=this;$body.delegate(".remove_form_item","click",function(t){var n=$(this).closest(".form-item");e.$section=$(this).closest(".section");n.remove();$('[data-targetitem="#'+n.attr("id")+'"]').closest("tr").remove();e._resetIndex();e._resetRemove();t.preventDefault()})},addFieldItem:function(){var e=this;$body.delegate(".add_field_item","click",function(t){t.preventDefault();e.$section=$(this).closest(".section");var n=e.$section.find(".form-fieldset"),r=e.$section.find(".form-2cloned .form-item:first"),i=r.clone();i.appendTo(n);i.find(".temporary-disabled").prop("disabled",!1).removeAttr("disabled");i.find("input,select,textearea").first().focus();e._resetRemove();e._resetIndex();globalJs.Global.priceFormat(i);i.find("input[type=text],textarea").val("")})},_resetIndex:function(){var e=this,t=0,n=e.$section.find(".form-fieldset .form-item"),r=e.$section.find(".form-2cloned .form-item"),i=[];r.first().find("input,select,checkbox,radio,textarea").each(function(){var e=$(this).attr("name");typeof e!="undefined"&&$.trim(e)!=""&&i.push(e)});n.each(function(){var e;for(e in i){var n=i[e].split("[0]"),r=n[0],s="["+t+"]",o=n[1],u=r+s+o;$(this).find('[name$="'+o+'"]').attr("name",u)}t++})},editQuickAction:function(){var e=this;$body.delegate(".edit_quick_action","click",function(e){var t=$($(this).data("targetitem"));if(t.length){var n=t.closest(".tab-pane");n.length&&$("a[href=#"+n.attr("id")+"]").trigger("click");var r=t.find("input,select,textarea,checkbox,radio").first();r.focus();$.taxform.h.windowFocus(r)}e.preventDefault()})},deleteQuickAction:function(){$body.delegate(".delete_quick_action","click",function(e){e.preventDefault();var t=$($(this).data("targetitem")),n=t.closest(".form-item"),r=t.closest(".form-fieldset").find(".form-item"),i=t.closest(".tab-pane");i.length&&$("a[href=#"+i.attr("id")+"]").trigger("click");var s=t.find("input:not([type=hidden]),select,textarea").first();$.taxform.h.windowFocus(s);$(this).closest("tr").remove();if(n.length)if(n.closest(".fieldset-exclude-first").length&&r.length>1||!n.closest(".fieldset-exclude-first").length){util.areYouSure.recheck();n.find(".remove_form_item").trigger("click");return""}t.find("input:not([type=hidden]),select,textarea").filter(":not(:disabled)").val("").keyup().first().focus()})}};$.taxform.details={init:function(){var e=this;e.$form=$("#details_form");e.formValidator();e.ifHasSpouse();e.copyPostal2Home()},copyPostal2Home:function(){function i(){var e=["address_1","address_2","post_code","suburb","state"];for(var t in e){var i=e[t],s=r.find("#input_postal_"+i).val();n.find("#input_home_"+i).val(s)}}function s(){n.get(0).reset}var e=this,t=e.$form.find("#input_home_is_postal"),n=e.$form.find("#home_address"),r=e.$form.find("#postal_address");r.find("input,select").bind("change keyup",function(){t.is(":checked")&&i()});t.change(function(){$(this).is(":checked")&&i()})},ifHasSpouse:function(){var e=this,t=e.$form.find("#has_spouse_wrapper"),n=e.$form.find('input[name="family_status[has_spouse]"]');n.on("change",function(){if($(this).is(":checked")&&$(this).val()==1)t.show();else{t.hide();t.find("*").val("")}});n.filter(":checked").val()==0&&t.hide()},formValidator:function(){var e=this;e.$form.jValidator({messageTo:$("#details_form_message"),onSuccess:function(e,t){}})}};$.taxform.income={init:function(){var e=this;e.$form=$("#income_form");e.incomeForm();e.calculateFrankedCredit()},incomeForm:function(){var e=this;e.$form.jValidator({messageTo:$("#income_form_message"),onSuccess:function(e,t){}})},calculateFrankedCredit:function(){$("body").delegate('input[name$="[franked_divident]"]',"keyup",function(){console.log($('input[name$="[franked_divident]"]'));var e=$(this).val();e=e.replace("$","");e=e.replace("$"," ");e=e.replace(","," ");$frankedCredit=$(this).closest(".form-item").find('input[name$="[franking_credit]"]');if(parseInt(e)>0){$credit=parseInt(e)*(.3/.7);$frankedCredit.val($credit.toFixed(0))}else $frankedCredit.val("")})}};$.taxform.deductions={init:function(){var e=this;e.carExpenses.init();e.travelExpenses.init();e.uniform.init();e.selfEducation.init();e.other.init()}};$.taxform.deductions.carExpenses={init:function(){var e=this;e.$form=$("#car_expenses_form");e.carExpensesForm();e.showHideLogBook();e.bindAddNew()},bindAddNew:function(){var e=this;$("#add_car_expenses").bind("click",function(){var e=$(this);setTimeout(function(){var t=e.closest(".section").find(".form-fieldset");if(t.length){$formItem=t.find(".form-item").last();if($formItem.length){var n=$formItem.find(".show_log_book");$.trim(n.text())=="Cancel"&&n.trigger("click")}}},200)})},carExpensesForm:function(){var e=this;e.$form.jValidator({messageTo:$("#car_expenses_form_message"),onSuccess:function(e,t){}})},showHideLogBook:function(){$body.delegate(".show_log_book","click",function(e){var t=$(this).closest(".form-item"),n=t.find(".log_book_wrapper"),r=t.find('input[name$="[has_claimed_log_book]"]'),i=t.find('input[name$="[business_kilometre]"]'),s=t.find('[name$="[cents_per_kilometre_id]"]');if(r.val()>=1){$(this).text("Click here");r.val(0);n.hide().removeClass("hidden");i.closest(".form-group").show().removeClass("hidden");s.closest(".form-group").show().removeClass("hidden")}else{r.val(1);$(this).text("Cancel");n.show().removeClass("hidden");i.closest(".form-group").hide().addClass("hidden");s.closest(".form-group").hide().addClass("hidden")}e.preventDefault()})}};$.taxform.deductions.travelExpenses={init:function(){var e=this;e.$form=$("#travel_expenses_form");e.travelExpensesForm()},travelExpensesForm:function(){var e=this;e.$form.jValidator({messageTo:$("#travel_expenses_form_message"),onSuccess:function(e,t){}})}};$.taxform.deductions.uniform={init:function(){var e=this;e.$form=$("#uniforms_form");e.UniformForm()},UniformForm:function(){var e=this;e.$form.jValidator({messageTo:$("#uniforms_form_message"),onSuccess:function(e,t){}})}};$.taxform.deductions.selfEducation={init:function(){var e=this;e.$form=$("#self_education_form");e.SelfEducationForm()},SelfEducationForm:function(){var e=this;e.$form.jValidator({messageTo:$("#self_education_form_message"),onSuccess:function(e,t){}})}};$.taxform.deductions.other={init:function(){var e=this;e.$form=$("#other_deduction_form");e.formValidator()},formValidator:function(){var e=this;e.$form.jValidator({messageTo:$("#other_deduction_form_message"),onSuccess:function(e,t){}})}};$.taxform.notesUpdate={init:function(){var e=this;e.$form=$("#update_notes_form");e.formValidator()},formValidator:function(){var e=this;e.$form.jValidator({messageTo:$("#update_notes_form_message"),onSuccess:function(e,t){}})}};$.taxform.statusUpdate={init:function(){var e=this;e.$form=$("#update_status_form");e.formValidator()},formValidator:function(){var e=this;e.$form.jValidator({onSuccess:function(e,t){}})}};$.taxform.taxOffsets={init:function(){var e=this;e.$form=$("#tax_offsets_form");e.formValidator();e.haveHelp();e.zoneOffsetDays()},formValidator:function(){var e=this;e.$form.jValidator({messageTo:$("#other_deduction_form_message"),onSuccess:function(e,t){}})},haveHelp:function(){$("#input_help_has_help_debt").change(function(){var e=$("#help_help_debt_amount").closest(".form-group");$(this).val()==1?e.show():e.hide()});$("#input_help_has_help_debt").change()},zoneOffsetDays:function(){$body.delegate('#zone_offset input[name$="_days]"]',"keyup",function(){var e=parseInt($(this).val()),t=$(this).closest(".form-group").next(".form-group").first().find("input").first();e>=183?t.val(t.data("target-value")):t.val(0);t.keyup()});$('#zone_offset input[name$="_days]"]').keyup()}};$.taxform.payment={init:function(){var e=this;e.$form=$("#payment_form");e.$agreementModal=$("#payment_agreement_modal");e.formValidator();e.paymentMethodEvent();e.onSelectAgreementEvent()},formValidator:function(){var e=this;e.$form.jValidator({messageTo:$("#payment_form_message"),onSuccess:function(t,n){e.$agreementModal.modal("hide");if(typeof t.nextProcess!="undefined"){var r=$(t.nextProcess);r.length&&r.modal("show");r.find("input[name=payment_agreement]").prop("checked",!1);r.find("button[type=submit]").addClass("disabled")}}})},onSelectAgreementEvent:function(){var e=this;e.$agreementModal.find("input[name=payment_agreement]").on("change",function(){var t=e.$agreementModal.find("button[type=submit]");$(this).is(":checked")?t.removeClass("disabled"):t.addClass("disabled")})},paymentMethodEvent:function(){$("input[name=payment_type]").on("change",function(e){$billTab=$("a[href='#bill']");$billTabContent=$("#bill");if($(this).val()=="fee_from_refund"){$billTab.hide();$billTab.closest("li").next("li").length&&$billTab.closest("li").next("li").first().find("a").trigger("click")}else{$billTab.show();$billTab.trigger("click")}e.preventDefault()})}};